<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="main.css" rel="stylesheet">

<title>tsk binary format version 0</title>
</head>

<body>
<header>
<h1><a href="/">tsk</a></h1>
</header>

<main>
<h2>tsk binary format version 0</h2>
<pre>
type <a id="type-State" href="#type-State">State</a> = {
  header : <a href="#type-StateHeader">StateHeader</a>,
  data : {
    current : <a href="#type-Set">Set</a> <a href="#type-StateId">StateId</a>,
    tasks : <a href="#type-Map">Map</a> <a href="#type-TaskId">TaskId</a> <a href="#type-Task">Task</a>,
    taskMetadata : <a href="#type-Map">Map</a> <a href="#type-TaskId">TaskId</a> <a href="#type-TaskMetadata">TaskMetadata</a>,
    comments : <a href="#type-Map">Map</a> <a href="#type-CommentId">CommentId</a> <a href="#type-Comment">Comment</a>,
    commentMetadata : <a href="#type-Map">Map</a> <a href="#type-CommentId">CommentId</a> <a href="#type-CommentMetadata">CommentMetadata</a>,
    history : <a href="#type-Map">Map</a> <a href="#type-StateId">StateId</a> <a href="#type-Commit">Commit</a>
  }
}

type <a id="type-StateHeader" href="#type-StateHeader">StateHeader</a> = {
  fileType : "tsk;",
  version : "version=https://tsk.ielliott.io/v0;",
  endOfHeader : "\n"
}

# The `List` is sorted in ascending order.
type <a id="type-Set" href="#type-Set">Set</a> a = <a href="#type-List">List</a> a

type <a id="type-List" href="#type-List">List</a> a = {
  len : <a href="#prim-Word64">Word64</a>,
  items : <a href="#prim-Vector">Vector</a> len a
}

prim <a id="prim-Word64" href="#prim-Word64">Word64</a> is "an 8 byte natural number (big endian)"

prim <a id="prim-Vector" href="#prim-Vector">Vector</a> len a is "`len` consecutive `a`s"

type <a id="type-StateId" href="#type-StateId">StateId</a> = <a href="#type-MD5">MD5</a>

type <a id="type-MD5" href="#type-MD5">MD5</a> = {
  0 : <a href="#prim-Word64">Word64</a>,
  1 : <a href="#prim-Word64">Word64</a>
}

# The `List` is sorted in ascending order on the first element of the pair
type <a id="type-Map" href="#type-Map">Map</a> k v = <a href="#type-List">List</a> (<a href="#type-Pair">Pair</a> k v)

type <a id="type-Pair" href="#type-Pair">Pair</a> a b = {
  fst : a,
  snd : b
}

type <a id="type-TaskId" href="#type-TaskId">TaskId</a> = <a href="#type-GID">GID</a>

type <a id="type-GID" href="#type-GID">GID</a> = {
  0 : <a href="#prim-Word16">Word16</a>,
  1 : <a href="#prim-Word16">Word16</a>,
  2 : <a href="#prim-Word16">Word16</a>,
  3 : <a href="#prim-Word16">Word16</a>,
  4 : <a href="#prim-Word16">Word16</a>
}

prim <a id="prim-Word16" href="#prim-Word16">Word16</a> is "a 2 byte natural number (big endian)"

type <a id="type-Task" href="#type-Task">Task</a> = {
  status : <a href="#type-Map">Map</a> <a href="#type-StateId">StateId</a> <a href="#type-Utf8">Utf8</a>,
  labels : <a href="#type-Map">Map</a> <a href="#type-StateId">StateId</a> (<a href="#type-Set">Set</a> <a href="#type-Utf8">Utf8</a>),
  title : <a href="#type-Map">Map</a> <a href="#type-StateId">StateId</a> <a href="#type-Utf8">Utf8</a>,
  description : <a href="#type-Map">Map</a> <a href="#type-StateId">StateId</a> <a href="#type-Utf8">Utf8</a>
}

type <a id="type-Utf8" href="#type-Utf8">Utf8</a> = {
  length : <a href="#prim-Word64">Word64</a>,
  bytes : <a href="#prim-Vector">Vector</a> length <a href="#prim-Word8">Word8</a>
}

prim <a id="prim-Word8" href="#prim-Word8">Word8</a> is "a byte (big endian)"

type <a id="type-TaskMetadata" href="#type-TaskMetadata">TaskMetadata</a> = {
  createdAt : <a href="#type-UTCTime">UTCTime</a>
}

# Milliseconds since 1970-01-01T00:00Z
type <a id="type-UTCTime" href="#type-UTCTime">UTCTime</a> = <a href="#prim-Word64">Word64</a>

type <a id="type-CommentId" href="#type-CommentId">CommentId</a> = <a href="#type-GID">GID</a>

type <a id="type-Comment" href="#type-Comment">Comment</a> = {
  description : <a href="#type-Map">Map</a> <a href="#type-StateId">StateId</a> <a href="#type-Utf8">Utf8</a>
}

type <a id="type-CommentMetadata" href="#type-CommentMetadata">CommentMetadata</a> = {
  createdAt : <a href="#type-UTCTime">UTCTime</a>,
  replyTo : <a href="#type-ReplyId">ReplyId</a>
}

type <a id="type-ReplyId" href="#type-ReplyId">ReplyId</a> = {
  tag : <a href="#prim-Word64">Word64</a>,
  value : match tag {
    0 => <a href="#type-TaskId">TaskId</a>,
    1 => <a href="#type-CommentId">CommentId</a>
  }
}

type <a id="type-Commit" href="#type-Commit">Commit</a> = {
  parents : <a href="#type-Set">Set</a> <a href="#type-StateId">StateId</a>,
  change : <a href="#type-Change">Change</a>
}

type <a id="type-Change" href="#type-Change">Change</a> = {
  tag : <a href="#prim-Word64">Word64</a>,
  value : match tag {
    0 => {
      status : <a href="#type-Utf8">Utf8</a>,
      labels : <a href="#type-Set">Set</a> <a href="#type-Utf8">Utf8</a>,
      title : <a href="#type-Utf8">Utf8</a>,
      description : <a href="#type-Utf8">Utf8</a>
    },
    1 => {
      taskId : <a href="#type-TaskId">TaskId</a>,
      updateTask : {
        status : <a href="#type-Update">Update</a> <a href="#type-Utf8">Utf8</a>,
        labels : <a href="#type-Update">Update</a> (<a href="#type-Set">Set</a> <a href="#type-Utf8">Utf8</a>),
        title : <a href="#type-Update">Update</a> <a href="#type-Utf8">Utf8</a>,
        description : <a href="#type-Update">Update</a> <a href="#type-Utf8">Utf8</a>
      }
    },
    2 => {
      replyTo : <a href="#type-ReplyId">ReplyId</a>,
      comment : {
        description : <a href="#type-Utf8">Utf8</a>
      }
    },
    3 => {
      commentId : <a href="#type-CommentId">CommentId</a>,
      updateComment : {
        description : <a href="#type-Update">Update</a> <a href="#type-Utf8">Utf8</a>
      }
    }
  }
}

type <a id="type-Update" href="#type-Update">Update</a> a = {
  tag : <a href="#prim-Word64">Word64</a>,
  value : match tag {
    0 => {},
    1 => a,
    2 => <a href="#type-StateId">StateId</a>
  }
}

</pre>
</main>
</body>
</html>

